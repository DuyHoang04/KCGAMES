<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liên hệ - KCGAMES</title>
    <link rel="icon" type="image/png" href="/public/Image/logo-Photoroom.png">
    <link rel="stylesheet" href="/public/css/header.css">
    <link rel="stylesheet" href="/public/css/lienhe.css">
    <link rel="stylesheet" href="/public/css/footer.css">
    <script src="/public/js/header.js"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>

<body>
    <div id="header_lienhe"></div>

    <img id="main_page" src="/public/Image/draw-3583548_1280.png" alt="">
    <section id="section-lienhe">
        <div id="section-form">
            <div style="padding-bottom: 30px;" id="lienlac">
                <h2>LIÊN LẠC</h2>
            </div>
            <form id="section-content">
                <div id="hoten-email">
                    <input id="full_name" type="text" name="full_name" placeholder="Họ và tên" required>

                    <input id="email" type="email" name="email" placeholder="Email" required>
                </div>
                <textarea name="notes" id="notes" placeholder="Nội dung liên hệ" required></textarea>
                <br>

                <input type="hidden" name="phone" value="[Không có SDT]">
                <input type="hidden" name="job_position" value="[Liên hệ website]">
                <input type="hidden" name="resume" value="">

                <button id="btn_send" type="submit">Gửi ngay</button>
            </form>
        </div>
    </section>

    <div id="main-content">
        <div id="content-maps">
            <div id="text-content">
                <h1 style="padding: 10px 0 10px 0;margin-left: 10px;">Địa chỉ</h1>
                <p style="margin-left: 10px;"><i class='bx bx-map' style="padding-right: 3px;font-size: 24px;"></i>227
                    Phạm Văn Đồng, Bắc Từ Liêm, Hà Nội</p>
            </div>
            <div id="map">
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3403.0287465242054!2d105.78344567485034!3d21.073795680586787!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135aacdb0944319%3A0xe529ed39f60dd3a4!2zMjI3IMSQLiBQaOG6oW0gVsSDbiDEkOG7k25nLCBYdcOibiDEkOG7iW5oLCBC4bqvYyBU4burIExpw6ptLCBIw6AgTuG7mWkgMTE5MDgsIFZp4buHdCBOYW0!5e1!3m2!1svi!2s!4v1762425372452!5m2!1svi!2s"
                    style="border-radius:10px ; margin-left: 10px;" width="1000px" height="450" style="border:0;"
                    allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>

    </div>

    <script>
        // === HÀM TÁI SỬ DỤNG: LOGIC MENU MOBILE (GIỮ NGUYÊN) ===
        function initializeMobileMenu() {
            const navbar = document.getElementById('navbar');
            const mobileToggle = document.getElementById('mobile-toggle');

            if (mobileToggle && navbar) {
                const menuIcon = mobileToggle.querySelector('i');

                mobileToggle.addEventListener('click', () => {
                    navbar.classList.toggle('active');

                    if (navbar.classList.contains('active')) {
                        menuIcon.classList.remove('fa-bars');
                        menuIcon.classList.add('fa-times');
                    } else {
                        menuIcon.classList.remove('fa-times');
                        menuIcon.classList.add('fa-bars');
                    }
                });
            }
        }

        // === HÀM TÁI SỬ DỤNG: LOGIC ACTIVE LINK (GIỮ NGUYÊN) ===
        function setActiveNav() {
            const navLinkEls = document.querySelectorAll('.nav_link');
            const windowPathname = window.location.pathname;

            navLinkEls.forEach(navLinkEl => {
                const navLinkPathname = new URL(navLinkEl.href).pathname;
                const normalizedWindowPath = (windowPathname === '/index.html' || windowPathname === '') ? '/' : windowPathname;
                const normalizedNavLinkPath = (navLinkPathname === '/index.index' || navLinkPathname === '/index.html') ? '/' : navLinkPathname;
                navLinkEl.classList.remove('active');
                if (normalizedWindowPath === normalizedNavLinkPath) {
                    navLinkEl.classList.add('active');
                }
            });
        }

        // === HÀM TẢI VÀ CHÈN HTML BẤT ĐỒNG BỘ (GIỮ NGUYÊN) ===
        async function loadHTML(url, containerId, callback = () => { }) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch ${url}: ${response.statusText}`);
                }
                const htmlContent = await response.text();

                // Đảm bảo phần tử tồn tại trước khi chèn
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = htmlContent;
                    callback(); // GỌI CALLBACK SAU KHI HTML ĐÃ ĐƯỢC CHÈN
                } else {
                    console.error(`LỖI: Không tìm thấy container ID '${containerId}'`);
                }
            } catch (error) {
                console.error("Error loading HTML:", error);
            }
        }

        // === HÀM GỌI CALLBACK: TỔNG HỢP CÁC KHỞI TẠO (GIỮ NGUYÊN) ===
        function afterHeaderLoad() {
            setActiveNav(); // Đặt link active
            initializeMobileMenu(); // Khởi tạo cơ chế menu mobile
        }

        // === THỰC THI CHƯƠNG TRÌNH ===
        document.addEventListener('DOMContentLoaded', () => {
            // ❌ LỖI TRƯỚC ĐÂY: Bạn gọi setActiveNav() thay vì afterHeaderLoad().
            // SỬA: Thay setActiveNav bằng afterHeaderLoad để khởi tạo cả menu mobile.
            loadHTML('./html/client/header.html', 'header_lienhe', afterHeaderLoad);
            loadHTML('./html/client/footer.html', 'footer_lienhe');

            // === LOGIC GỬI FORM (GIỮ NGUYÊN) ===
            const form = document.getElementById('section-content');

            if (!form) {
                console.error("LỖI KHÔNG TÌM THẤY: Form với ID 'section-content' không tồn tại.");
                return;
            }

            const submitButton = document.querySelector('#btn_send');

            if (!submitButton) {
                console.error("LỖI KHÔNG TÌM THẤY: Button với ID 'btn_send' không tồn tại.");
                return;
            }

            const SERVER_ENDPOINT = "/api/send-contact";

            form.addEventListener('submit', function (e) {
                e.preventDefault();

                const formData = new FormData(form);
                const urlSearchParams = new URLSearchParams(formData);
                const bodyEncoded = urlSearchParams.toString();

                submitButton.disabled = true;
                submitButton.textContent = 'Đang gửi...';

                fetch(SERVER_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: bodyEncoded
                })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(data => { throw new Error(data.message || `Lỗi không xác định (Mã: ${response.status})`); });
                        }
                        return response.json();
                    })
                    .then((data) => {
                        if (data.success) {
                            alert('✅ Gửi thông tin thành công');
                            form.reset();
                        } else {
                            throw new Error(data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Lỗi gửi đơn:', error);
                        alert(`❌ Gửi đơn không thành công. Chi tiết lỗi: ${error.message}`);
                    })
                    .finally(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'GỬI ĐƠN LIÊN HỆ';
                    });
            });
        });
    </script>
    <div id="footer_lienhe"></div>
</body>

</html>